<!DOCTYPE html>
<html>
<head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<meta content='Thane Gill | Some subtitle' name='description'>
<meta content='Thane Gill' name='author'>
<link href='http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<title>Mutable Class Initializers in Swift</title>
<link href="../../../../../css/bootstrap.css" rel="stylesheet" type="text/css" />
<link href="../../../../../css/clean-blog.css" rel="stylesheet" type="text/css" />

</head>
<body class='blog blog_2015 blog_2015_12 blog_2015_12_22 blog_2015_12_22_mutable-class-initilizers-in-swift blog_2015_12_22_mutable-class-initilizers-in-swift_index'>
<!-- Navigation -->
<nav class='navbar navbar-default navbar-custom navbar-fixed-top'>
<div class='container-fluid'>
<!-- Brand and toggle get grouped for better mobile display -->
<div class='navbar-header page-scroll'>
<button class='navbar-toggle' data-target='#bs-example-navbar-collapse-1' data-toggle='collapse' type='button'>
<span class='sr-only'>Toggle navigation</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand' href='/'>
<i class='fa fa-anchor'></i>
</a>
</div>
<!-- Collect the nav links, forms, and other content for toggling -->
<div class='collapse navbar-collapse' id='bs-example-navbar-collapse-1'>
<ul class='nav navbar-nav navbar-right'>
<li><a href="/">Blog</a></li>
<li><a href="/about">About</a></li>
<li><a href="/resume">Resume</a></li>
<li>
<a class='fa fa-rss-square' href='/feed.xml'></a>
</li>
</ul>
</div>
</div>
</nav>

<header class='intro-header' style="background-image: url('/images/default.jpg')">
<div class='container'>
<div class='row'>
<div class='col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1'>
<div class='post-heading'>
<h1>Mutable Class Initializers in Swift</h1>
<span class='meta'>December 22, 2015</span>
</div>
</div>
</div>
</div>
</header>
<article>
<div class='container'>
<div class='row'>
<div class='col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1'>
<p>How many times have you wanted mutate self in the initializer? Apparently it&rsquo;s
totally possible in swift, just not an enabled feature. It&rsquo;s on Apples
<a href="rdar://23224354">radar</a> and Chris Lattner has acknowledged it:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/thanegill">@thanegill</a> It would have to have the same type as the dynamic Self type, to work w/ derived classes. Enabling this hasn&rsquo;t been a priority.</p>&mdash; Chris Lattner (@clattner_llvm) <a href="https://twitter.com/clattner_llvm/status/657287462876659712">October 22, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Submitting this as a proposal on the Swift evolution mailing list still yet to
be done. Let me know if you&rsquo;d like to help write up a proposal.</p>

<p>As Salva Pestov <a href="https://twitter.com/slava_pestov/status/658058425398464512">pointed
out</a> to me protocol
extensions can mutate self as they are never inherited. This this is now
possible, though a bit ugly: [<sup>](test</sup> footnote)</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">MutateSelf</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">extension</span> <span class="kt">MutateSelf</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">mutateSelfAs</span> <span class="nv">object</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span> <span class="o">=</span> <span class="n">object</span>
    <span class="p">}</span>

    <span class="c1">// Failable initializer, useful for objects that conform to RawRepresetable</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">?(</span><span class="n">mutateSelfAs</span> <span class="nv">object</span><span class="p">:</span> <span class="k">Self</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">object</span> <span class="o">=</span> <span class="n">object</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="n">object</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>This leads to cool uses that make UIKit more swifty:</p>
<pre class="highlight swift"><code><span class="c1">// Extending NSObject becasue AnyObject cannot be extended</span>
<span class="kd">extension</span> <span class="kt">NSObject</span><span class="p">:</span> <span class="kt">MutateSelf</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">extension</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="n">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="n">fromStoryboard</span> <span class="nv">storyboard</span><span class="p">:</span> <span class="kt">UIStoryboard</span><span class="p">,</span> <span class="n">storyboardID</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">mutateSelfAs</span><span class="p">:</span> <span class="n">storyboard</span><span class="o">.</span><span class="nf">instantiateViewControllerWithIdentifier</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SomeViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">SomeObject</span>

    <span class="n">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="n">fromStoryboard</span> <span class="nv">storyboard</span><span class="p">:</span> <span class="kt">UIStoryboard</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">SomeObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">fromStoryboard</span><span class="p">:</span> <span class="n">storyboard</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">object</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">methodThatShowsAView</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">newViewController</span> <span class="o">=</span> <span class="kt">NewViewController</span><span class="p">(</span><span class="nv">fromStoryboard</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">storyboard</span><span class="o">!</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">navigationController</span><span class="p">?</span><span class="o">.</span><span class="nf">pushViewController</span><span class="p">(</span><span class="n">newViewController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>This also fixes my displease with dependency injection and removes the need for
forced unwrapped optionals! ðŸŽ‰ You can now just initialize your new VC passing it
the current storyboard and push to it with your navigation controller. Much
simpler and easier to read!</p>

</div>
</div>
</div>
</article>

<hr id='page_footer'>
<footer>
<div class='container'>
<div class='row'>
<div class='col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1'>
<ul class='list-inline text-center'>
<li>
<a href='https://twitter.com/thanegill'>
<span class='fa-stack fa-lg'>
<i class='fa fa-circle fa-stack-2x'></i>
<i class='fa fa-twitter fa-stack-1x fa-inverse'></i>
</span>
</a>
</li>
<li>
<a href='https://github.com/thanegill'>
<span class='fa-stack fa-lg'>
<i class='fa fa-circle fa-stack-2x'></i>
<i class='fa fa-github fa-stack-1x fa-inverse'></i>
</span>
</a>
</li>
<li>
<a href='#email-protection-zr@gunartvyy.pbz'>
<span class='fa-stack fa-lg'>
<i class='fa fa-circle fa-stack-2x'></i>
<i class='fa fa-envelope-o fa-stack-1x fa-inverse'></i>
</span>
</a>
</li>
</ul>
<p class='copyright text-muted'>Copyright Â© Thane Gill 2015</p>
<p class='copyright text-muted'><a href="https://github.com/thanegill/thanegill.github.io">Hosted with Github pages</a></p>
</div>
</div>
</div>
</footer>
<script src="../../../../../js/jquery.js" type="text/javascript"></script><script src="../../../../../js/clean-blog.js" type="text/javascript"></script><script src="../../../../../js/bootstrap.js" type="text/javascript"></script>

<script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body>
</html>
